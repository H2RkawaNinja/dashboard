<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BST</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="gang-logo">
                    <img src="logo.png" alt="BST Gang Logo" class="gang-logo-img">
                </div>
                <p></p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label>Benutzername</label>
                    <input type="text" id="username" required autofocus>
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> Einloggen
                </button>
                <div id="login-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <img src="logo.png" alt="BST Gang Logo" class="sidebar-logo-img">
                <h2>GIG</h2>
            </div>
            <div class="user-profile">
                <div>
                    <strong id="user-display-name"></strong>
                    <span id="user-rank"></span>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-page="overview">
                    <i class="fas fa-home"></i><span>√úbersicht</span>
                </a>
                <a href="#" class="nav-item" data-page="members">
                    <i class="fas fa-users"></i><span>Mitglieder</span>
                </a>
                <a href="#" class="nav-item" data-page="fence">
                    <i class="fas fa-handshake"></i><span>Hehler-Gesch√§ft</span>
                </a>
                <a href="#" class="nav-item" data-page="warehouse">
                    <i class="fas fa-box-open"></i><span>Sortier Bereich</span>
                </a>
                <a href="#" class="nav-item" data-page="storage">
                    <i class="fas fa-warehouse"></i><span>Lager</span>
                </a>
                <a href="#" class="nav-item" data-page="treasury">
                    <i class="fas fa-piggy-bank"></i><span>Gangkasse</span>
                </a>
                <a href="#" class="nav-item" data-page="recipes">
                    <i class="fas fa-book"></i><span>Rezepte</span>
                </a>
                <a href="#" class="nav-item" data-page="intelligence">
                    <i class="fas fa-user-secret"></i><span>Intel-Sammlung</span>
                </a>
                <a href="#" class="nav-item" data-page="activity">
                    <i class="fas fa-clipboard-list"></i><span>Aktivit√§ten</span>
                </a>
                <a href="#" class="nav-item" data-page="maintenance" id="maintenance-nav" style="display: none;">
                    <i class="fas fa-tools"></i><span>System Wartung</span>
                </a>
            </nav>
            <button id="logout-btn" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> Abmelden
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1 id="page-title">√úbersicht</h1>
                <div class="header-time">
                    <i class="fas fa-clock"></i>
                    <span id="current-time"></span>
                </div>
            </header>

            <!-- √úbersicht Page -->
            <div id="overview-page" class="page active">
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <i class="fas fa-users"></i>
                        <div>
                            <h3>Aktive Mitglieder</h3>
                            <p class="stat-number" id="stat-members">0</p>
                        </div>
                    </div>

                    <div class="stat-card orange">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <h3>Offene Abrechnungen</h3>
                            <p class="stat-number" id="stat-pending">0</p>
                        </div>
                    </div>
                    <div class="stat-card purple">
                        <i class="fas fa-warehouse"></i>
                        <div>
                            <h3>Lagerwert</h3>
                            <p class="stat-number" id="stat-warehouse">$0</p>
                        </div>
                    </div>

                    <!-- Gangkasse Statistiken -->
                    <div class="stat-card treasury" id="treasury-balance-card">
                        <i class="fas fa-piggy-bank"></i>
                        <div>
                            <h3>Kassenstand</h3>
                            <p class="stat-number" id="stat-treasury-balance">‚Ç¨ 0,00</p>
                        </div>
                    </div>
                    
                    <div class="stat-card green">
                        <i class="fas fa-arrow-up"></i>
                        <div>
                            <h3>Einzahlungen (Monat)</h3>
                            <p class="stat-number" id="stat-treasury-deposits">‚Ç¨ 0,00</p>
                        </div>
                    </div>
                    
                    <div class="stat-card red">
                        <i class="fas fa-arrow-down"></i>
                        <div>
                            <h3>Auszahlungen (Monat)</h3>
                            <p class="stat-number" id="stat-treasury-withdrawals">‚Ç¨ 0,00</p>
                        </div>
                    </div>
                    
                    <div class="stat-card teal">
                        <i class="fas fa-users-cog"></i>
                        <div>
                            <h3>Beitr√§ge bezahlt</h3>
                            <p class="stat-number" id="stat-treasury-contributions">0/0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card warning">
                        <i class="fas fa-exclamation-circle"></i>
                        <div>
                            <h3>Ausstehende Beitr√§ge</h3>
                            <p class="stat-number" id="stat-treasury-outstanding">‚Ç¨ 0,00</p>
                        </div>
                    </div>
                </div>

                <div class="card notes-card">
                    <h2>Notizen & Informationen</h2>
                    <div class="notes-section">
                        <!-- Edit Mode Toggle -->
                        <div class="notes-header">
                            <button id="edit-notes-btn" class="btn-secondary edit-toggle">
                                <i class="fas fa-edit"></i> Bearbeiten
                            </button>
                            <button id="view-notes-btn" class="btn-secondary edit-toggle" style="display: none;">
                                <i class="fas fa-eye"></i> Ansicht
                            </button>
                        </div>
                        
                        <!-- Rich Text Toolbar (hidden by default) -->
                        <div class="notes-toolbar" id="notes-toolbar" style="display: none;">
                            <div class="toolbar-group">
                                <button type="button" class="toolbar-btn" data-command="bold" title="Fett">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button type="button" class="toolbar-btn" data-command="italic" title="Kursiv">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button type="button" class="toolbar-btn" data-command="underline" title="Unterstreichen">
                                    <i class="fas fa-underline"></i>
                                </button>
                            </div>
                            
                            <div class="toolbar-group">
                                <select class="toolbar-select" id="font-size" title="Textgr√∂√üe">
                                    <option value="12px">Klein</option>
                                    <option value="14px" selected>Normal</option>
                                    <option value="16px">Gro√ü</option>
                                    <option value="18px">Gr√∂√üer</option>
                                    <option value="24px">Sehr gro√ü</option>
                                    <option value="32px">Riesig</option>
                                </select>
                            </div>
                            
                            <div class="toolbar-group">
                                <button type="button" class="toolbar-btn color-btn" data-color="#ffffff" title="Wei√ü" style="background: #ffffff;"></button>
                                <button type="button" class="toolbar-btn color-btn" data-color="#10b981" title="Gr√ºn" style="background: #10b981;"></button>
                                <button type="button" class="toolbar-btn color-btn" data-color="#3b82f6" title="Blau" style="background: #3b82f6;"></button>
                                <button type="button" class="toolbar-btn color-btn" data-color="#f59e0b" title="Gelb" style="background: #f59e0b;"></button>
                                <button type="button" class="toolbar-btn color-btn" data-color="#ef4444" title="Rot" style="background: #ef4444;"></button>
                                <button type="button" class="toolbar-btn color-btn" data-color="#8b5cf6" title="Lila" style="background: #8b5cf6;"></button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button type="button" class="toolbar-btn bg-color-btn" data-bg-color="transparent" title="Kein Hintergrund">
                                    <i class="fas fa-fill-drip"></i>
                                </button>
                                <button type="button" class="toolbar-btn bg-color-btn" data-bg-color="#10b981" title="Gr√ºner Hintergrund" style="background: #10b981;"></button>
                                <button type="button" class="toolbar-btn bg-color-btn" data-bg-color="#f59e0b" title="Gelber Hintergrund" style="background: #f59e0b;"></button>
                                <button type="button" class="toolbar-btn bg-color-btn" data-bg-color="#ef4444" title="Roter Hintergrund" style="background: #ef4444;"></button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button type="button" class="toolbar-btn" data-command="removeFormat" title="Formatierung entfernen">
                                    <i class="fas fa-eraser"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Rich Text Editor -->
                        <div 
                            id="overview-notes" 
                            class="rich-text-editor view-mode"
                            contenteditable="false"
                            placeholder="Hier k√∂nnen wichtige Informationen, Notizen oder Ank√ºndigungen f√ºr alle Mitglieder eingetragen werden..."
                        ></div>
                        
                        <div class="notes-actions" id="edit-actions" style="display: none;">
                            <button id="save-notes-btn" class="btn-primary">
                                <i class="fas fa-save"></i> Speichern & Fertig
                            </button>
                            <button id="clear-notes-btn" class="btn-secondary">
                                <i class="fas fa-trash"></i> Leeren
                            </button>
                            <span id="notes-status" class="notes-status"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mitglieder Page -->
            <div id="members-page" class="page">
                <div class="page-header">
                    <button class="btn-primary" id="add-member-btn" onclick="showAddMemberModal()" style="display: none;">
                        <i class="fas fa-user-plus"></i> Mitglied hinzuf√ºgen
                    </button>
                </div>
                <div class="card">
                    <h2>Mitgliederliste</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Benutzername</th>
                                <th>Rang</th>
                                <th>Berechtigungen</th>
                                <th>Passwort</th>
                                <th>Telefon</th>
                                <th>Letzter Login</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="members-table"></tbody>
                    </table>
                </div>
            </div>

            <!-- Hehler Page -->
            <div id="fence-page" class="page">
                <div id="fence-no-permission" class="info-banner" style="display: none; background: #ff9800; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>Keine Berechtigung:</strong> Sie haben keine Berechtigung, Hehler-Ank√§ufe einzutragen. Wenden Sie sich an einen Administrator.
                </div>
                
                <!-- Tabs f√ºr verschiedene Ansichten -->
                <div class="fence-tabs">
                    <button class="fence-tab active" onclick="switchFenceTab('products')">
                        <i class="fas fa-shopping-cart"></i> Schnellankauf
                    </button>
                    <button class="fence-tab" onclick="switchFenceTab('sales')">
                        <i class="fas fa-dollar-sign"></i> Verkauf
                    </button>
                    <button class="fence-tab" onclick="switchFenceTab('manage')">
                        <i class="fas fa-cog"></i> Produktverwaltung
                    </button>
                </div>

                <!-- Produkte & Schnellankauf Tab -->
                <div id="fence-products-tab" class="fence-tab-content active">
                    <div class="stats-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card-small blue">
                            <h4>Ank√§ufe heute</h4>
                            <p class="big-number" id="fence-count-today">0</p>
                        </div>
                        <div class="stat-card-small red">
                            <h4>Ausgaben heute</h4>
                            <p class="big-number" id="fence-spent-today">$0</p>
                        </div>
                        <div class="stat-card-small green">
                            <h4>Umsatz heute</h4>
                            <p class="big-number" id="fence-revenue-today">$0</p>
                        </div>
                        <div class="stat-card-small purple">
                            <h4>Gewinn heute</h4>
                            <p class="big-number" id="fence-profit-today">$0</p>
                        </div>
                    </div>

                    <div class="fence-products-layout">
                        <!-- Produkte Grid (links) -->
                        <div class="fence-products-main">
                            <div class="card">
                                <div class="card-header-flex">
                                    <h2><i class="fas fa-boxes"></i> Schnellankauf - Produkte</h2>
                                    <input type="text" id="product-search" class="search-input" placeholder="üîç Produkte durchsuchen..." oninput="filterProducts()">
                                </div>
                                <div id="products-grid" class="products-grid">
                                    <!-- Produkte werden hier dynamisch geladen -->
                                </div>
                            </div>
                        </div>

                        <!-- Warenkorb Sidebar (rechts) -->
                        <div class="fence-cart-sidebar">
                            <div class="card cart-sticky">
                                <div class="cart-sidebar-header">
                                    <h2><i class="fas fa-shopping-cart"></i> Warenkorb</h2>
                                    <span class="cart-badge" id="page-cart-badge">0</span>
                                </div>
                                
                                <div id="page-cart-items" class="page-cart-items">
                                    <div class="cart-empty-state">
                                        <i class="fas fa-shopping-cart"></i>
                                        <p>Warenkorb ist leer</p>
                                        <small>Klicken Sie auf "Schnellankauf" bei einem Produkt</small>
                                    </div>
                                </div>

                                <div id="page-cart-summary" class="page-cart-summary" style="display: none;">
                                    <div class="page-cart-total-row">
                                        <span>Artikel:</span>
                                        <strong><span id="page-cart-count">0</span></strong>
                                    </div>
                                    <div class="page-cart-total-row">
                                        <span>Gesamt:</span>
                                        <strong><span id="page-cart-quantity">0</span>x</strong>
                                    </div>
                                    <div class="page-cart-total-row total">
                                        <span>Summe:</span>
                                        <strong class="total-price">$<span id="page-cart-total">0.00</span></strong>
                                    </div>
                                    
                                    <button class="btn-success btn-block" onclick="proceedToCheckout()">
                                        <i class="fas fa-check"></i> Zur Kasse
                                    </button>
                                    <button class="btn-text-danger btn-block" onclick="clearCart()" style="margin-top: 0.5rem;">
                                        <i class="fas fa-trash"></i> Warenkorb leeren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Verkauf Tab -->
                <div id="fence-sales-tab" class="fence-tab-content">
                    <div class="stats-grid" style="margin-bottom: 2rem; grid-template-columns: repeat(3, 1fr);">
                        <div class="stat-card-small green">
                            <h4>Verk√§ufe heute</h4>
                            <p class="big-number" id="fence-sales-today">0</p>
                        </div>
                        <div class="stat-card-small blue">
                            <h4>Umsatz heute</h4>
                            <p class="big-number" id="fence-revenue-today-2">$0</p>
                        </div>
                        <div class="stat-card-small purple">
                            <h4>Gewinn heute</h4>
                            <p class="big-number" id="fence-profit-today-2">$0</p>
                        </div>
                    </div>

                    <div class="fence-products-layout">
                        <!-- Produkte Grid f√ºr Verkauf (links) -->
                        <div class="fence-products-main">
                            <div class="card">
                                <div class="card-header-flex">
                                    <h2><i class="fas fa-dollar-sign"></i> Schnellverkauf - Produkte</h2>
                                    <input type="text" id="sales-product-search" class="search-input" placeholder="üîç Produkte durchsuchen..." oninput="filterSalesProducts()">
                                </div>
                                <div id="sales-products-grid" class="products-grid">
                                    <!-- Verkaufs-Produkte werden hier dynamisch geladen -->
                                </div>
                            </div>
                        </div>

                        <!-- Verkaufs-Warenkorb Sidebar (rechts) -->
                        <div class="fence-cart-sidebar">
                            <div class="card cart-sticky">
                                <div class="cart-sidebar-header">
                                    <h2><i class="fas fa-cash-register"></i> Verkaufskorb</h2>
                                    <span class="cart-badge" id="sales-cart-badge">0</span>
                                </div>
                                
                                <div id="sales-cart-items" class="page-cart-items">
                                    <div class="cart-empty-state">
                                        <i class="fas fa-cash-register"></i>
                                        <p>Verkaufskorb ist leer</p>
                                        <small>Klicken Sie auf "Verkaufen" bei einem Produkt</small>
                                    </div>
                                </div>

                                <div id="sales-cart-summary" class="page-cart-summary" style="display: none;">
                                    <div class="page-cart-total-row">
                                        <span>Artikel:</span>
                                        <strong><span id="sales-cart-count">0</span></strong>
                                    </div>
                                    <div class="page-cart-total-row">
                                        <span>Einkauf:</span>
                                        <strong class="text-danger">$<span id="sales-cart-cost">0.00</span></strong>
                                    </div>
                                    <div class="page-cart-total-row">
                                        <span>Verkauf:</span>
                                        <strong class="text-success">$<span id="sales-cart-revenue">0.00</span></strong>
                                    </div>
                                    <div class="page-cart-total-row total">
                                        <span>Gewinn:</span>
                                        <strong class="total-price profit">$<span id="sales-cart-profit">0.00</span></strong>
                                    </div>
                                    
                                    <button class="btn-success btn-block" onclick="proceedToSalesCheckout()">
                                        <i class="fas fa-check"></i> Verkauf abschlie√üen
                                    </button>
                                    <button class="btn-text-danger btn-block" onclick="clearSalesCart()" style="margin-top: 0.5rem;">
                                        <i class="fas fa-trash"></i> Verkaufskorb leeren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Produktverwaltung Tab -->
                <div id="fence-manage-tab" class="fence-tab-content">
                    <div class="card">
                        <div class="card-header-flex">
                            <h2><i class="fas fa-cog"></i> Produktverwaltung</h2>
                            <div class="header-actions">
                                <button class="btn-primary" onclick="showAddProductModal()">
                                    <i class="fas fa-plus"></i> Neues Produkt
                                </button>
                                <button class="view-btn active" onclick="switchManageView('cards')" id="view-cards-btn">
                                    <i class="fas fa-th-large"></i> Karten
                                </button>
                                <button class="view-btn" onclick="switchManageView('table')" id="view-table-btn">
                                    <i class="fas fa-list"></i> Tabelle
                                </button>
                            </div>
                        </div>

                        <!-- Karten-Ansicht -->
                        <div id="manage-cards-view" class="manage-view active">
                            <div id="products-manage-grid" class="products-grid">
                                <!-- Produktkarten werden hier geladen -->
                            </div>
                        </div>

                        <!-- Tabellen-Ansicht -->
                        <div id="manage-table-view" class="manage-view">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Produktname</th>
                                        <th>Kategorie</th>
                                        <th>Standard-Ankaufspreis</th>
                                        <th>Standard-Verkaufspreis</th>
                                        <th>Gewinnspanne</th>
                                        <th>Status</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="products-manage-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sortier Bereich Page -->
            <div id="warehouse-page" class="page">
                <!-- Unsortierte Artikel Section -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <h2 style="margin-bottom: 0.5rem;">Unsortierte Artikel</h2>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Ziehen Sie die Artikel in die Lagerpl√§tze unten</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="badge" id="unsorted-count-badge" style="background: var(--danger); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600;">
                                0 Artikel
                            </div>
                            <button class="btn-success" id="finish-storage-btn" onclick="finishStorageOrganization()" style="display: none;">
                                <i class="fas fa-check"></i> Lagerung fertig
                            </button>
                        </div>
                    </div>
                    <div id="unsorted-items-grid" class="unsorted-items-grid"></div>
                </div>

                <!-- Lagerpl√§tze Section -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2>Lagerpl√§tze</h2>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="btn-primary" onclick="showAddStorageSlotModal()">
                                <i class="fas fa-plus"></i> Lagerplatz hinzuf√ºgen
                            </button>
                            <button class="btn-secondary" onclick="toggleWarehouseView()">
                                <i class="fas fa-table"></i> <span id="warehouse-view-text">Tabellenansicht</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Grid View f√ºr Lagerpl√§tze -->
                    <div id="storage-grid-view" class="storage-grid-view">
                        <div id="storage-sections-container" class="storage-sections">
                            <!-- Lagerpl√§tze werden dynamisch geladen -->
                        </div>
                    </div>

                    <!-- Table View (alte Ansicht) -->
                    <div id="storage-table-view" class="storage-table-view" style="display: none;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Artikel</th>
                                    <th>Kategorie</th>
                                    <th>Menge</th>
                                    <th>Wert/St√ºck</th>
                                    <th>Gesamtwert</th>
                                    <th>Standort</th>
                                    <th>Letzte √Ñnderung</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="warehouse-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Lager Overview Page -->
            <div id="storage-page" class="page">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div>
                            <h2 style="margin-bottom: 0.5rem;">Lager √úbersicht</h2>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Alle eingelagerten Artikel nach Lagerpl√§tzen</p>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <div class="badge" style="background: var(--primary); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600;">
                                <span id="total-storage-items">0</span> Artikel
                            </div>
                            <div class="badge" style="background: var(--success); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600;">
                                $<span id="total-storage-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lager Sections -->
                    <div id="storage-overview-sections" class="storage-sections">
                        <!-- Dynamisch geladen -->
                    </div>
                </div>
            </div>

            <!-- Aktivit√§ten Page -->
            <!-- Activity Page -->
            <div id="activity-page" class="page">
                <div class="card">
                    <h2>Aktivit√§tsprotokoll</h2>
                    <div id="activity-log" class="activity-list"></div>
                </div>
            </div>

            <!-- System Wartung Page (nur f√ºr Techniker) -->
            <div id="maintenance-page" class="page">
                <div class="card">
                    <h2><i class="fas fa-tools"></i> System Wartung</h2>
                    <p class="maintenance-info">Bereiche tempor√§r deaktivieren, wenn sie unter Bearbeitung stehen.</p>
                    
                    <div class="maintenance-sections">
                        <div class="maintenance-section">
                            <h3>Mitglieder-System</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-members">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Mitgliederverwaltung</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Hero-Verkauf</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-hero">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Hero-Lager und Verk√§ufe</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Hehler-System</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-fence">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Hehler-Gesch√§fte</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Sortier-Bereich</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-warehouse">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Sortierbereich und unsortierte Artikel</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Lager-System</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-storage">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Lagerpl√§tze und gespeicherte Artikel</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Gangkasse (Treasury)</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-treasury">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Transaktionen und Beitragsverwaltung</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Rezepte</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-recipes">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Herstellungsrezepte</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Intel-Sammlung</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-intelligence">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Intelligence-Datenbank</p>
                        </div>
                        
                        <div class="maintenance-section">
                            <h3>Aktivit√§ts-Log</h3>
                            <label class="maintenance-toggle">
                                <input type="checkbox" id="maintenance-activity">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Wartungsmodus aktivieren</span>
                            </label>
                            <p class="maintenance-description">Verhindert Zugriff auf Aktivit√§tenprotokoll</p>
                        </div>
                    </div>
                    
                    <div class="maintenance-actions">
                        <button class="btn-primary" onclick="saveMaintenanceSettings()">
                            <i class="fas fa-save"></i> Einstellungen speichern
                        </button>
                        <button class="btn-warning" onclick="disableAllSystems()">
                            <i class="fas fa-exclamation-triangle"></i> Alle Systeme deaktivieren
                        </button>
                        <button class="btn-success" onclick="enableAllSystems()">
                            <i class="fas fa-check"></i> Alle Systeme aktivieren
                        </button>
                    </div>
                </div>
            </div>

            <!-- Treasury Page -->
            <div id="treasury-page" class="page">
                <div class="treasury-page-header">
                    <div class="treasury-title-section">
                        <h2><i class="fas fa-piggy-bank"></i> Gangkasse</h2>
                        <p class="treasury-subtitle">Beitr√§ge, Ziele und Statistiken</p>
                    </div>
                    <div class="treasury-balance">
                        <span class="balance-label">Kassenstand:</span>
                        <span class="balance-amount" id="treasury-balance">$ 0,00</span>
                        <button class="btn-adjust-balance" onclick="showAdjustBalanceModal()" title="Kassenstand anpassen">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>

                <!-- Treasury Tabs -->
                <div class="treasury-tabs">
                    <button class="tab-btn active" onclick="switchTreasuryTab(this, 'contributions')">
                        <i class="fas fa-users"></i> Beitr√§ge
                    </button>
                    <button class="tab-btn" onclick="switchTreasuryTab(this, 'goals')">
                        <i class="fas fa-bullseye"></i> Ziele
                    </button>
                    <button class="tab-btn" onclick="switchTreasuryTab(this, 'transactions')">
                        <i class="fas fa-exchange-alt"></i> Kassenbuch
                    </button>
                    <button class="tab-btn" onclick="switchTreasuryTab(this, 'overview')">
                        <i class="fas fa-chart-bar"></i> Statistiken
                    </button>
                </div>

                <!-- Contributions Tab (Beitr√§ge) -->
                <div id="treasury-contributions-tab" class="treasury-tab-content active">
                    <div class="contributions-header">
                        <div class="contribution-period">
                            <label for="contribution-period-select">Zeitraum:</label>
                            <select id="contribution-period-select" onchange="renderContributions()">
                                <option value="">Alle Zeitr√§ume</option>
                            </select>
                        </div>
                        <div class="contribution-actions">
                            <button class="btn-secondary" onclick="createWeeklyContributions()">
                                <i class="fas fa-calendar-plus"></i> Neuer Zeitraum
                            </button>
                            <button class="btn-primary" onclick="showMarkContributionModal()">
                                <i class="fas fa-check"></i> Beitrag verbuchen
                            </button>
                        </div>
                    </div>

                    <div class="contributions-list" id="contributions-list">
                        <!-- Beitr√§ge werden hier dynamisch geladen -->
                    </div>
                </div>

                <!-- Goals Tab (Ziele) -->
                <div id="treasury-goals-tab" class="treasury-tab-content">
                    <div class="goals-header">
                        <h3>Gemeinsame Ziele</h3>
                        <button class="btn-primary" onclick="showAddGoalModal()">
                            <i class="fas fa-plus"></i> Neues Ziel
                        </button>
                    </div>

                    <div class="goals-list" id="goals-list">
                        <!-- Ziele werden hier dynamisch geladen -->
                    </div>
                </div>

                <!-- Transactions Tab (Kassenbuch) -->
                <div id="treasury-transactions-tab" class="treasury-tab-content">
                    <div class="transactions-header">
                        <div class="transactions-search-wrapper">
                            <i class="fas fa-search"></i>
                            <input type="text" id="transaction-search" placeholder="Suchen..." oninput="filterTransactions()">
                        </div>
                        <div class="transaction-type-filter">
                            <select id="transaction-type-filter" onchange="filterTransactions()">
                                <option value="">Alle</option>
                                <option value="beitrag">Beitr√§ge</option>
                                <option value="einzahlung">Einzahlungen</option>
                                <option value="auszahlung">Auszahlungen</option>
                                <option value="ziel_einzahlung">Ziel-Einzahlungen</option>
                                <option value="korrektur">Korrekturen</option>
                            </select>
                        </div>
                        <button class="btn-primary btn-add-transaction" onclick="showAddTransactionModal()">
                            <i class="fas fa-plus"></i> Neue Buchung
                        </button>
                    </div>

                    <div class="transactions-list" id="transactions-list">
                        <!-- Transaktionen werden hier dynamisch geladen -->
                    </div>
                </div>

                <!-- Overview Tab (Statistiken) -->
                <div id="treasury-overview-tab" class="treasury-tab-content">
                    <div class="treasury-overview-grid">
                        <div class="treasury-stat-card green">
                            <i class="fas fa-arrow-up"></i>
                            <div>
                                <h3 id="total-deposits">$ 0,00</h3>
                                <p>Einnahmen (Monat)</p>
                            </div>
                        </div>
                        <div class="treasury-stat-card red">
                            <i class="fas fa-arrow-down"></i>
                            <div>
                                <h3 id="total-withdrawals">$ 0,00</h3>
                                <p>Ausgaben (Monat)</p>
                            </div>
                        </div>
                        <div class="treasury-stat-card blue">
                            <i class="fas fa-users"></i>
                            <div>
                                <h3 id="paid-members">0/0</h3>
                                <p>Beitr√§ge bezahlt</p>
                            </div>
                        </div>
                        <div class="treasury-stat-card orange">
                            <i class="fas fa-bullseye"></i>
                            <div>
                                <h3 id="active-goals">0</h3>
                                <p>Aktive Ziele</p>
                            </div>
                        </div>
                    </div>

                    <div class="treasury-charts">
                        <div class="recent-transactions">
                            <h4>Letzte Buchungen</h4>
                            <div id="recent-transactions-list">
                                <!-- Letzte Transaktionen -->
                            </div>
                        </div>
                        <div class="top-contributors">
                            <h4>Top Einzahler</h4>
                            <div id="top-contributors-list">
                                <!-- Top Einzahler -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipes Page -->
            <div id="recipes-page" class="page">
                <div class="recipes-page-header">
                    <div class="recipes-title-section">
                        <h2><i class="fas fa-book"></i> Herstellungs-Rezepte</h2>
                        <p class="recipes-subtitle">Anleitungen f√ºr alle Produkte</p>
                    </div>
                    <button class="btn-primary btn-add-recipe" onclick="showAddRecipeModal()">
                        <i class="fas fa-plus"></i> Neues Rezept
                    </button>
                </div>

                <!-- Filter und Suche -->
                <div class="recipes-filter-bar">
                    <div class="recipe-search-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="recipe-search" placeholder="Rezept suchen..." oninput="filterRecipes()">
                    </div>
                    <div class="recipe-category-filters">
                        <button class="recipe-filter-btn active" data-category="" onclick="setRecipeCategory(this, '')">
                            <i class="fas fa-th"></i> Alle
                        </button>
                        <button class="recipe-filter-btn" data-category="Waffen" onclick="setRecipeCategory(this, 'Waffen')">
                            <i class="fas fa-gun"></i> Waffen
                        </button>
                        <button class="recipe-filter-btn" data-category="Drogen" onclick="setRecipeCategory(this, 'Drogen')">
                            <i class="fas fa-pills"></i> Drogen
                        </button>
                        <button class="recipe-filter-btn" data-category="Ausr√ºstung" onclick="setRecipeCategory(this, 'Ausr√ºstung')">
                            <i class="fas fa-vest"></i> Ausr√ºstung
                        </button>
                        <button class="recipe-filter-btn" data-category="Fahrzeuge" onclick="setRecipeCategory(this, 'Fahrzeuge')">
                            <i class="fas fa-car"></i> Fahrzeuge
                        </button>
                        <button class="recipe-filter-btn" data-category="Sonstiges" onclick="setRecipeCategory(this, 'Sonstiges')">
                            <i class="fas fa-box"></i> Sonstiges
                        </button>
                    </div>
                </div>

                <!-- Rezepte Liste -->
                <div id="recipes-container" class="recipes-grid-new"></div>
                
                <!-- Empty State -->
                <div id="recipes-empty" class="recipes-empty-state" style="display: none;">
                    <i class="fas fa-book-open"></i>
                    <h3>Keine Rezepte gefunden</h3>
                    <p>Es wurden keine Rezepte gefunden, die deinen Filterkriterien entsprechen.</p>
                </div>
            </div>

            <!-- Intelligence Page -->
            <div id="intelligence-page" class="page">
                <div class="page-header">
                    <h2>Kontakte & Gangs</h2>
                    <button class="btn-primary" onclick="showAddIntelModal()">
                        <i class="fas fa-plus"></i> Neuer Kontakt
                    </button>
                </div>

                <!-- Filter und Suche -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="filters-row">
                        <div class="form-group" style="flex: 1;">
                            <input type="text" id="intel-search" placeholder="Suchen..." oninput="filterIntelligence()">
                        </div>
                        <div class="form-group" style="width: 200px;">
                            <select id="intel-filter-category" onchange="filterIntelligence()">
                                <option value="">Alle Typen</option>
                                <option value="Person">Personen</option>
                                <option value="Gang">Gangs</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Intelligence Grid -->
                <div id="intelligence-grid" class="intelligence-grid"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        
        <!-- Lagerplatz Modal -->
        <div id="storage-slot-modal" class="modal" style="display: none; max-width: 500px;">
            <div class="modal-header">
                <h2 id="storage-slot-modal-title">Lagerplatz hinzuf√ºgen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="storage-slot-form">
                <input type="hidden" id="storage-slot-id">
                <input type="hidden" id="storage-slot-old-code">
                
                <div class="form-group">
                    <label>Besitzer</label>
                    <select id="storage-slot-owner">
                        <option value="">-- Kein Besitzer --</option>
                    </select>
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Wem geh√∂rt dieses Lager</small>
                </div>
                
                <div class="form-group">
                    <label>Lager-ID</label>
                    <input type="text" id="storage-slot-warehouse-id" required pattern="[0-9]{8}" placeholder="z.B. 12345678" maxlength="8">
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Genau 8 Ziffern - Identifikationsnummer des Lagers</small>
                </div>
                
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="text" id="storage-slot-password" pattern="[0-9]{4}" placeholder="z.B. 0000" maxlength="4">
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Genau 4 Ziffern (optional)</small>
                </div>
                
                <div class="form-group">
                    <label>Standort</label>
                    <select id="storage-slot-location" required>
                        <option value="Paleto">Paleto</option>
                        <option value="Grapseed">Grapseed</option>
                        <option value="Northside">Northside</option>
                        <option value="Westside">Westside</option>
                        <option value="Eastside">Eastside</option>
                        <option value="Mirror Park">Mirror Park</option>
                        <option value="Southside">Southside</option>
                        <option value="Harmony">Harmony</option>
                    </select>
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Fester Standort des Lagers</small>
                </div>
                
                <div style="display: flex; gap: 0.75rem;">
                    <button type="button" class="btn-secondary" onclick="closeModals()" style="flex: 1;">Abbrechen</button>
                    <button type="submit" class="btn-primary" style="flex: 1;">Speichern</button>
                </div>
            </form>
        </div>
        
        <!-- L√∂schbest√§tigungs-Modal -->
        <div id="delete-confirm-modal" class="modal" style="display: none; max-width: 450px;">
            <div class="modal-header" style="background: #dc3545; color: white;">
                <h2><i class="fas fa-exclamation-triangle"></i> Mitglied l√∂schen?</h2>
                <button class="close-modal" onclick="closeModals()" style="color: white;">&times;</button>
            </div>
            <div style="padding: 30px;">
                <p style="font-size: 16px; margin-bottom: 20px; text-align: center;">
                    Bist du sicher, dass du <strong id="delete-member-name" style="color: #dc3545;"></strong> aus der Gang entfernen m√∂chtest?
                </p>
                <p style="font-size: 14px; color: #666; margin-bottom: 25px; text-align: center;">
                    Das Mitglied wird dauerhaft gel√∂scht. Alle Verk√§ufe und Aktivit√§ten bleiben jedoch erhalten.
                </p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn-secondary" onclick="closeModals()" style="min-width: 120px;">
                        <i class="fas fa-times"></i> Abbrechen
                    </button>
                    <button id="confirm-delete-btn" class="btn-danger" style="min-width: 120px; background: #dc3545;">
                        <i class="fas fa-trash"></i> L√∂schen
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Lagerplatz L√∂schbest√§tigung Modal -->
        <div id="delete-storage-modal" class="modal" style="display: none; max-width: 500px;">
            <div class="modal-header" style="background: #ff6b6b; color: white;">
                <h2><i class="fas fa-warehouse"></i> Lagerplatz l√∂schen</h2>
                <button class="close-modal" onclick="closeModals()" style="color: white;">&times;</button>
            </div>
            <div style="padding: 2rem;">
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.25rem;">
                    <p style="margin: 0; color: #856404; font-weight: 500;">
                        <i class="fas fa-exclamation-circle"></i> Achtung: Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!
                    </p>
                </div>
                <p style="font-size: 1.1rem; margin-bottom: 1rem; text-align: center;">
                    M√∂chtest du den Lagerplatz <strong id="delete-storage-code" style="color: #ff6b6b; font-size: 1.2rem;"></strong> wirklich l√∂schen?
                </p>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    <p style="margin: 0; color: #495057; font-size: 0.95rem;">
                        <i class="fas fa-info-circle" style="color: #17a2b8;"></i> Alle Artikel in diesem Lagerplatz werden automatisch in den Bereich <strong>"Unsortiert"</strong> verschoben und k√∂nnen dort neu zugeordnet werden.
                    </p>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn-secondary" onclick="closeModals()" style="min-width: 140px; padding: 0.75rem 1.5rem;">
                        <i class="fas fa-times"></i> Abbrechen
                    </button>
                    <button id="confirm-delete-storage-btn" class="btn-danger" style="min-width: 140px; padding: 0.75rem 1.5rem; background: #ff6b6b; border-color: #ff6b6b;">
                        <i class="fas fa-trash-alt"></i> Jetzt l√∂schen
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Artikel L√∂schbest√§tigung Modal -->
        <div id="delete-item-modal" class="modal" style="display: none; max-width: 500px;">
            <div class="modal-header" style="background: #dc3545; color: white;">
                <h2><i class="fas fa-box-open"></i> Artikel l√∂schen</h2>
                <button class="close-modal" onclick="closeModals()" style="color: white;">&times;</button>
            </div>
            <div style="padding: 2rem;">
                <div style="background: #ffe5e5; border-left: 4px solid #dc3545; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.25rem;">
                    <p style="margin: 0; color: #721c24; font-weight: 500;">
                        <i class="fas fa-exclamation-triangle"></i> Warnung: Dieser Artikel wird endg√ºltig gel√∂scht!
                    </p>
                </div>
                <p style="font-size: 1.1rem; margin-bottom: 1rem; text-align: center;">
                    M√∂chtest du den Artikel <strong id="delete-item-name" style="color: #dc3545; font-size: 1.2rem;"></strong> wirklich l√∂schen?
                </p>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    <p style="margin: 0; color: #495057; font-size: 0.95rem;">
                        <i class="fas fa-info-circle" style="color: #dc3545;"></i> Diese Aktion kann <strong>nicht r√ºckg√§ngig</strong> gemacht werden. Der Artikel wird dauerhaft aus dem Lager entfernt.
                    </p>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn-secondary" onclick="closeModals()" style="min-width: 140px; padding: 0.75rem 1.5rem;">
                        <i class="fas fa-times"></i> Abbrechen
                    </button>
                    <button id="confirm-delete-item-btn" class="btn-danger" style="min-width: 140px; padding: 0.75rem 1.5rem; background: #dc3545; border-color: #dc3545;">
                        <i class="fas fa-trash-alt"></i> Jetzt l√∂schen
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Zahlung Modal -->
        <div id="payment-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Zahlung buchen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="payment-form">
                <input type="hidden" id="payment-distribution-id">
                <div class="form-group">
                    <label>Mitglied</label>
                    <input type="text" id="payment-member-name" readonly>
                </div>
                <div class="form-group">
                    <label>Gang-Anteil gesamt</label>
                    <input type="text" id="payment-total" readonly>
                </div>
                <div class="form-group">
                    <label>Bereits bezahlt</label>
                    <input type="text" id="payment-already-paid" readonly>
                </div>
                <div class="form-group">
                    <label>Noch offen</label>
                    <input type="text" id="payment-remaining" readonly>
                </div>
                <div class="form-group">
                    <label>Zahlungsbetrag ($)</label>
                    <input type="number" id="payment-amount" step="0.01" required min="0.01">
                </div>
                <button type="submit" class="btn-success">Zahlung buchen</button>
            </form>
        </div>

        <!-- Hehler Ankauf Modal -->
        <div id="fence-purchase-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Ankauf eintragen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="fence-purchase-form">
                <div class="form-group">
                    <label>Artikel ausw√§hlen</label>
                    <select id="fence-item-select" onchange="selectFenceItem()">
                        <option value="">-- Artikel ausw√§hlen --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Artikel (oder eigenen eingeben)</label>
                    <input type="text" id="fence-item-name" required>
                </div>
                <div class="form-group">
                    <label>Menge</label>
                    <input type="number" id="fence-quantity" required min="1" value="1" oninput="calculateFenceTotal()">
                </div>
                <div class="form-group">
                    <label>Preis pro St√ºck ($)</label>
                    <input type="number" id="fence-unit-price" required min="0" step="0.01" oninput="calculateFenceTotal()">
                </div>
                <div class="form-group">
                    <label>Verk√§ufer Info</label>
                    <input type="text" id="fence-seller-info">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="fence-stored-warehouse"> Direkt ins Lager einlagern
                    </label>
                </div>
                <div class="form-group">
                    <label>Notizen (optional)</label>
                    <textarea id="fence-notes" rows="2"></textarea>
                </div>
                <div class="sale-calculation">
                    <p><strong>Gesamtpreis: $<span id="fence-total-calc">0.00</span></strong></p>
                </div>
                <button type="submit" class="btn-primary">Ankauf eintragen</button>
            </form>
        </div>

        <!-- Hehler Verkauf Modal -->
        <div id="fence-sale-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Verkauf erfassen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="fence-sale-form">
                <div class="form-group">
                    <label>Ankauf ausw√§hlen (optional)</label>
                    <select id="fence-purchase-select">
                        <option value="">-- Bestehender Ankauf --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Artikel</label>
                    <input type="text" id="fence-sale-item-name" required>
                </div>
                <div class="form-group">
                    <label>Menge</label>
                    <input type="number" id="fence-sale-quantity" required min="1" value="1" oninput="calculateFenceSaleTotal()">
                </div>
                <div class="form-group">
                    <label>Einkaufspreis pro St√ºck ($)</label>
                    <input type="number" id="fence-sale-unit-cost" required min="0" step="0.01" oninput="calculateFenceSaleTotal()">
                </div>
                <div class="form-group">
                    <label>Verkaufspreis pro St√ºck ($)</label>
                    <input type="number" id="fence-sale-unit-price" required min="0" step="0.01" oninput="calculateFenceSaleTotal()">
                </div>
                <div class="form-group">
                    <label>K√§ufer Info (optional)</label>
                    <input type="text" id="fence-sale-buyer-info">
                </div>
                <div class="sale-calculation">
                    <p><strong>Gesamtumsatz: $<span id="fence-sale-total-calc">0.00</span></strong></p>
                    <p><strong>Gewinn: $<span id="fence-sale-profit-calc">0.00</span></strong></p>
                </div>
                <button type="submit" class="btn-success">Verkauf erfassen</button>
            </form>
        </div>

        <!-- Hehler Ankauf Bearbeiten Modal -->
        <div id="edit-fence-purchase-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Ankauf bearbeiten</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="edit-fence-purchase-form">
                <input type="hidden" id="edit-fence-purchase-id">
                <div class="form-group">
                    <label>Artikel</label>
                    <input type="text" id="edit-fence-item-name" required>
                </div>
                <div class="form-group">
                    <label>Menge</label>
                    <input type="number" id="edit-fence-quantity" required min="1">
                </div>
                <div class="form-group">
                    <label>Preis pro St√ºck ($)</label>
                    <input type="number" id="edit-fence-unit-price" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Verk√§ufer Info</label>
                    <input type="text" id="edit-fence-seller-info">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-fence-stored-warehouse"> Im Lager
                    </label>
                </div>
                <div class="form-group">
                    <label>Notizen (optional)</label>
                    <textarea id="edit-fence-notes" rows="2"></textarea>
                </div>
                <button type="submit" class="btn-primary">√Ñnderungen speichern</button>
            </form>
        </div>

        <!-- Produktverwaltung Modal -->
        <div id="product-management-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Produktverwaltung</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <div style="margin-bottom: 15px;">
                <button class="btn-primary" onclick="showAddProductModal()">
                    <i class="fas fa-plus"></i> Neues Produkt
                </button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Artikel</th>
                        <th>Kategorie</th>
                        <th>Richtpreis</th>
                        <th>Status</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="product-templates-table"></tbody>
            </table>
        </div>

        <!-- Produkt hinzuf√ºgen Modal -->
        <div id="add-product-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Neues Produkt</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="add-product-form">
                <div class="form-group">
                    <label>Artikelname</label>
                    <input type="text" id="new-product-name" required>
                </div>
                <div class="form-group">
                    <label>Kategorie</label>
                    <select id="new-product-category" required>
                        <option value="Waffen">Waffen</option>
                        <option value="Drogen">Drogen</option>
                        <option value="Elektronik">Elektronik</option>
                        <option value="Schmuck">Schmuck</option>
                        <option value="Fahrzeuge">Fahrzeuge</option>
                        <option value="Sonstiges">Sonstiges</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Richtpreis ($)</label>
                    <input type="number" id="new-product-price" step="0.01" min="0" value="0">
                </div>
                <button type="submit" class="btn-primary">Produkt hinzuf√ºgen</button>
            </form>
        </div>

        <!-- Produkt bearbeiten Modal -->
        <div id="edit-product-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Produkt bearbeiten</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="edit-product-form">
                <input type="hidden" id="edit-product-id">
                <div class="form-group">
                    <label>Artikelname</label>
                    <input type="text" id="edit-product-name" required>
                </div>
                <div class="form-group">
                    <label>Kategorie</label>
                    <select id="edit-product-category" required>
                        <option value="Waffen">Waffen</option>
                        <option value="Drogen">Drogen</option>
                        <option value="Elektronik">Elektronik</option>
                        <option value="Schmuck">Schmuck</option>
                        <option value="Fahrzeuge">Fahrzeuge</option>
                        <option value="Sonstiges">Sonstiges</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Richtpreis ($)</label>
                    <input type="number" id="edit-product-price" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-product-active"> Aktiv
                    </label>
                </div>
                <button type="submit" class="btn-primary">√Ñnderungen speichern</button>
            </form>
        </div>

        <!-- Schnellankauf Modal (f√ºr Produktkarten) -->
        <div id="quick-purchase-modal" class="modal" style="display: none; max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-shopping-cart"></i> Schnellankauf - Warenkorb</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="quick-purchase-form">
                
                <!-- Aktuelles Produkt hinzuf√ºgen -->
                <div class="add-to-cart-section">
                    <input type="hidden" id="quick-product-id">
                    <input type="hidden" id="quick-product-name">
                    <input type="hidden" id="quick-product-icon">
                    <input type="hidden" id="quick-product-category">
                    
                    <div class="quick-purchase-header">
                        <div class="quick-product-icon" id="quick-product-display-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3 id="quick-product-display-name">Produkt</h3>
                            <p class="text-muted" id="quick-product-display-category">Kategorie</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Menge</label>
                            <div class="quantity-control">
                                <button type="button" class="qty-btn" onclick="changeQuickQty(-1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" id="quick-quantity" min="1" value="1" oninput="calculateQuickTotal()">
                                <button type="button" class="qty-btn" onclick="changeQuickQty(1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Ankaufspreis pro St√ºck ($)</label>
                            <input type="number" id="quick-unit-price" min="0" step="0.01" oninput="calculateQuickTotal()">
                        </div>
                    </div>

                    <div class="quick-total-display" style="margin-bottom: 1rem;">
                        <div class="quick-total-row">
                            <span>Zwischensumme:</span>
                            <strong class="total-price">$<span id="quick-total-display">0.00</span></strong>
                        </div>
                    </div>

                    <button type="button" class="btn-success btn-block" onclick="addToCart()">
                        <i class="fas fa-plus"></i> Zum Warenkorb hinzuf√ºgen
                    </button>
                </div>
            </form>
        </div>

        <!-- Warenkorb Checkout Modal -->
        <div id="cart-checkout-modal" class="modal" style="display: none; max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-shopping-basket"></i> Warenkorb - Ankauf abschlie√üen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="cart-checkout-form">
                <div class="cart-header" style="margin-bottom: 1rem;">
                    <h3 style="font-size: 1rem; margin: 0;"><i class="fas fa-list"></i> Artikel im Warenkorb</h3>
                    <button type="button" class="btn-text-danger" onclick="clearCart()">
                        <i class="fas fa-trash"></i> Warenkorb leeren
                    </button>
                </div>
                <div id="checkout-cart-items" class="cart-items">
                    <!-- Warenkorb-Items werden hier dynamisch eingef√ºgt -->
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label>Verk√§ufer Info (optional)</label>
                    <input type="text" id="checkout-seller-info" placeholder="Name oder Details zum Verk√§ufer">
                </div>

                <div class="cart-total">
                    <div class="cart-total-row">
                        <span>Artikel im Warenkorb:</span>
                        <strong><span id="checkout-item-count">0</span></strong>
                    </div>
                    <div class="cart-total-row">
                        <span>Gesamtmenge:</span>
                        <strong><span id="checkout-total-quantity">0</span>x</strong>
                    </div>
                    <div class="cart-total-row total">
                        <span>Gesamtpreis:</span>
                        <strong class="total-price">$<span id="checkout-total-price">0.00</span></strong>
                    </div>
                </div>

                <button type="submit" class="btn-primary btn-block">
                    <i class="fas fa-check"></i> Ankauf abschlie√üen (<span id="checkout-submit-total">$0.00</span>)
                </button>
            </form>
        </div>

        <!-- Verkaufs Modal (neu) -->
        <div id="sell-item-modal" class="modal" style="display: none; max-width: 600px;">
            <div class="modal-header" style="background: var(--secondary);">
                <h2><i class="fas fa-dollar-sign"></i> Artikel verkaufen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="sell-item-form">
                <input type="hidden" id="sell-item-name">
                <input type="hidden" id="sell-max-quantity">
                <input type="hidden" id="sell-purchase-price">
                <input type="hidden" id="sell-item-icon">
                <input type="hidden" id="sell-item-category">
                
                <div class="quick-purchase-header" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1));">
                    <div class="quick-product-icon" id="sell-item-display-icon" style="background: linear-gradient(135deg, var(--secondary), var(--info));">
                        <i class="fas fa-box"></i>
                    </div>
                    <div style="flex: 1;">
                        <h3 id="sell-item-display-name">Produkt</h3>
                        <p class="text-muted" id="sell-item-display-category">Kategorie</p>
                        <div class="stock-badge">
                            <i class="fas fa-warehouse"></i>
                            <strong><span id="sell-item-stock">0</span></strong> auf Lager
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Menge verkaufen</label>
                        <div class="quantity-control">
                            <button type="button" class="qty-btn" onclick="changeSellQty(-1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="sell-quantity" required min="1" value="1" oninput="calculateSellFromQuantity()">
                            <button type="button" class="qty-btn" onclick="changeSellQty(1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <small class="form-hint" id="sell-quantity-hint">Max: 0 St√ºck</small>
                    </div>
                </div>

                <div class="price-input-group">
                    <div class="form-group">
                        <label>Verkaufspreis pro St√ºck ($)</label>
                        <input type="number" id="sell-unit-price" required min="0" step="0.01" oninput="calculateSellFromUnitPrice()">
                        <small class="form-hint">√ò Einkauf: $<span id="sell-avg-purchase">0.00</span></small>
                    </div>

                    <div class="price-divider">
                        <i class="fas fa-exchange-alt"></i>
                    </div>

                    <div class="form-group">
                        <label>Gesamt-Verkaufspreis ($)</label>
                        <input type="number" id="sell-total-price" required min="0" step="0.01" oninput="calculateSellFromTotalPrice()">
                        <small class="form-hint">Preis f√ºr alle Artikel zusammen</small>
                    </div>
                </div>

                <div class="form-group">
                    <label>K√§ufer Info (optional)</label>
                    <input type="text" id="sell-buyer-info" placeholder="Name oder Details zum K√§ufer">
                </div>

                <div class="sell-calculation">
                    <div class="sell-calc-row">
                        <span><i class="fas fa-shopping-bag"></i> Einkaufskosten:</span>
                        <strong class="text-danger">-$<span id="sell-total-cost">0.00</span></strong>
                    </div>
                    <div class="sell-calc-row">
                        <span><i class="fas fa-dollar-sign"></i> Verkaufserl√∂s:</span>
                        <strong class="text-success">+$<span id="sell-total-revenue">0.00</span></strong>
                    </div>
                    <div class="sell-calc-row total">
                        <span><i class="fas fa-chart-line"></i> Gewinn:</span>
                        <strong class="total-price profit">$<span id="sell-total-profit">0.00</span></strong>
                    </div>
                    <div class="sell-calc-row margin">
                        <span>Gewinnmarge:</span>
                        <strong class="margin-value"><span id="sell-margin">0</span>%</strong>
                    </div>
                </div>

                <button type="submit" class="btn-success btn-block" style="font-size: 1.1rem; padding: 1rem;">
                    <i class="fas fa-check-circle"></i> Verkauf zum Warenkorb hinzuf√ºgen
                </button>
            </form>
        </div>

        <!-- Produkt hinzuf√ºgen/bearbeiten Modal (neu) -->
        <div id="product-modal" class="modal" style="display: none; max-width: 600px;">
            <div class="modal-header">
                <h2 id="product-modal-title">Neues Produkt</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="product-form">
                <input type="hidden" id="product-id">
                
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label>Produktname *</label>
                        <input type="text" id="product-name" required placeholder="z.B. Laptop, Rolex, Glock 19">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Icon</label>
                        <select id="product-icon">
                            <option value="fa-gun">üî´ Waffe</option>
                            <option value="fa-pills">üíä Drogen</option>
                            <option value="fa-laptop">üíª Elektronik</option>
                            <option value="fa-gem">üíé Schmuck</option>
                            <option value="fa-car">üöó Fahrzeug</option>
                            <option value="fa-box">üì¶ Sonstiges</option>
                            <option value="fa-mobile-alt">üì± Handy</option>
                            <option value="fa-tv">üì∫ TV</option>
                            <option value="fa-ring">üíç Ring</option>
                            <option value="fa-watch">‚åö Uhr</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Kategorie *</label>
                        <select id="product-category" required>
                            <option value="Waffen">Waffen</option>
                            <option value="Drogen">Drogen</option>
                            <option value="Elektronik">Elektronik</option>
                            <option value="Schmuck">Schmuck</option>
                            <option value="Fahrzeuge">Fahrzeuge</option>
                            <option value="Sonstiges">Sonstiges</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="product-status">
                            <option value="active">Aktiv</option>
                            <option value="inactive">Inaktiv</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Standard-Ankaufspreis ($)</label>
                        <input type="number" id="product-purchase-price" min="0" step="0.01" placeholder="0.00" oninput="calculateProductMargin()">
                    </div>
                    <div class="form-group">
                        <label>Standard-Verkaufspreis ($)</label>
                        <input type="number" id="product-sale-price" min="0" step="0.01" placeholder="0.00" oninput="calculateProductMargin()">
                    </div>
                </div>

                <div class="margin-display" id="margin-display" style="display: none;">
                    <div class="margin-info">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <strong>Gewinnspanne: <span id="margin-amount">$0.00</span></strong>
                            <span class="margin-percent">(<span id="margin-percent">0</span>%)</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Beschreibung (optional)</label>
                    <textarea id="product-description" rows="2" placeholder="Zus√§tzliche Informationen zum Produkt..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Mitglied hinzuf√ºgen Modal -->
        <div id="add-member-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Neues Mitglied hinzuf√ºgen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="add-member-form">
                <div class="form-group">
                    <label>Vollst√§ndiger Name</label>
                    <input type="text" id="new-member-name" required>
                </div>
                <div class="form-group">
                    <label>Benutzername</label>
                    <input type="text" id="new-member-username" required>
                </div>
                <div class="form-group">
                    <label>Rang</label>
                    <select id="new-member-rank" required>
                        <option value="OG">OG</option>
                        <option value="2OG">2OG</option>
                        <option value="Member">Member</option>
                        <option value="Techniker">Techniker</option>
                        <option value="Soldat">Soldat</option>
                        <option value="Runner">Runner</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Telefonnummer</label>
                    <input type="text" id="new-member-phone">
                </div>
                <div class="permissions-section">
                    <div class="permissions-header">
                        <h4><i class="fas fa-shield-alt"></i> Berechtigungen</h4>
                        <label class="toggle-all-label">
                            <span>Alle</span>
                            <input type="checkbox" class="toggle-all" data-target="new-member">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-cogs"></i> Verwaltung
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-user-plus perm-icon text-blue"></i>
                                <div>
                                    <span class="perm-name">Mitglieder verwalten</span>
                                    <span class="perm-desc">Kann neue Mitglieder hinzuf√ºgen und bearbeiten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-add">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-server perm-icon text-red"></i>
                                <div>
                                    <span class="perm-name">System verwalten</span>
                                    <span class="perm-desc">Zugriff auf Systemwartung und Einstellungen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-system">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-briefcase"></i> Gesch√§ft
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-handshake perm-icon text-green"></i>
                                <div>
                                    <span class="perm-name">Hehler-Gesch√§ft</span>
                                    <span class="perm-desc">Kann An- und Verk√§ufe im Hehler verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-fence">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-book perm-icon text-purple"></i>
                                <div>
                                    <span class="perm-name">Rezepte</span>
                                    <span class="perm-desc">Kann Rezepte einsehen und verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-recipes">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-warehouse perm-icon text-orange"></i>
                                <div>
                                    <span class="perm-name">Lager</span>
                                    <span class="perm-desc">Kann das Lager und Best√§nde verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-storage">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-eye"></i> Einsicht
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-clipboard-list perm-icon text-cyan"></i>
                                <div>
                                    <span class="perm-name">Aktivit√§ten</span>
                                    <span class="perm-desc">Kann das Aktivit√§ten-Log einsehen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-activity">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-chart-bar perm-icon text-yellow"></i>
                                <div>
                                    <span class="perm-name">Statistiken</span>
                                    <span class="perm-desc">Kann Statistiken und Auswertungen sehen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-member-can-stats">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Mitglied hinzuf√ºgen</button>
            </form>
        </div>

        <!-- Mitglied bearbeiten Modal -->
        <div id="edit-member-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Mitglied bearbeiten</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="edit-member-form">
                <input type="hidden" id="edit-member-id">
                <div class="form-group">
                    <label>Vollst√§ndiger Name</label>
                    <input type="text" id="edit-member-name" required>
                </div>
                <div class="form-group">
                    <label>Rang</label>
                    <select id="edit-member-rank" required>
                        <option value="OG">OG</option>
                        <option value="2OG">2OG</option>
                        <option value="Member">Member</option>
                        <option value="Techniker">Techniker</option>
                        <option value="Soldat">Soldat</option>
                        <option value="Runner">Runner</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Telefonnummer</label>
                    <input type="text" id="edit-member-phone">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-member-active">
                        Aktiv
                    </label>
                </div>
                <div class="permissions-section">
                    <div class="permissions-header">
                        <h4><i class="fas fa-shield-alt"></i> Berechtigungen</h4>
                        <label class="toggle-all-label">
                            <span>Alle</span>
                            <input type="checkbox" class="toggle-all" data-target="edit-member">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-cogs"></i> Verwaltung
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-user-plus perm-icon text-blue"></i>
                                <div>
                                    <span class="perm-name">Mitglieder verwalten</span>
                                    <span class="perm-desc">Kann neue Mitglieder hinzuf√ºgen und bearbeiten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-add">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-server perm-icon text-red"></i>
                                <div>
                                    <span class="perm-name">System verwalten</span>
                                    <span class="perm-desc">Zugriff auf Systemwartung und Einstellungen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-system">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-briefcase"></i> Gesch√§ft
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-handshake perm-icon text-green"></i>
                                <div>
                                    <span class="perm-name">Hehler-Gesch√§ft</span>
                                    <span class="perm-desc">Kann An- und Verk√§ufe im Hehler verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-fence">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-book perm-icon text-purple"></i>
                                <div>
                                    <span class="perm-name">Rezepte</span>
                                    <span class="perm-desc">Kann Rezepte einsehen und verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-recipes">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-warehouse perm-icon text-orange"></i>
                                <div>
                                    <span class="perm-name">Lager</span>
                                    <span class="perm-desc">Kann das Lager und Best√§nde verwalten</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-storage">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="perm-group">
                        <div class="perm-group-header">
                            <i class="fas fa-eye"></i> Einsicht
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-clipboard-list perm-icon text-cyan"></i>
                                <div>
                                    <span class="perm-name">Aktivit√§ten</span>
                                    <span class="perm-desc">Kann das Aktivit√§ten-Log einsehen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-activity">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="perm-item">
                            <div class="perm-info">
                                <i class="fas fa-chart-bar perm-icon text-yellow"></i>
                                <div>
                                    <span class="perm-name">Statistiken</span>
                                    <span class="perm-desc">Kann Statistiken und Auswertungen sehen</span>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-member-can-stats">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-primary">√Ñnderungen speichern</button>
            </form>
        </div>

        <!-- Invite Link Modal -->
        <div id="invite-link-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2>Einladungslink erstellt</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <div class="member-info" style="background: var(--dark-bg); padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Mitglied erfolgreich angelegt!</h3>
                    <p style="color: var(--text-secondary);">Sende dem neuen Mitglied diesen Link:</p>
                </div>
                <div class="form-group">
                    <label>Einladungslink</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="invite-link-display" readonly style="flex: 1;">
                        <button type="button" class="btn-primary" onclick="copyInviteLink()">
                            <i class="fas fa-copy"></i> Kopieren
                        </button>
                    </div>
                </div>
                <div style="background: var(--warning); color: var(--dark-bg); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                    <p style="margin: 0; font-size: 0.9rem;"><strong><i class="fas fa-exclamation-triangle"></i> Wichtig:</strong> Dieser Link ist 7 Tage g√ºltig. Das Mitglied muss √ºber diesen Link sein Passwort einrichten.</p>
                </div>
            </div>
        </div>

        <!-- Intelligence Modal -->
        <div id="intel-modal" class="modal" style="display: none;">
            <div class="modal-header">
                <h2 id="intel-modal-title">Neuer Kontakt</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="intel-form">
                <input type="hidden" id="intel-id">
                
                <div class="form-group">
                    <label>Typ *</label>
                    <select id="intel-category" required onchange="toggleTypeFields()">
                        <option value="Person">Person</option>
                        <option value="Gang">Gang</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label id="intel-name-label">Name *</label>
                    <input type="text" id="intel-subject" required placeholder="z.B. John Doe">
                </div>
                
                <div class="form-group" id="person-fields">
                    <label>Telefon</label>
                    <input type="text" id="intel-source" placeholder="z.B. 555-1234">
                </div>
                
                <div class="form-group" id="gang-fields" style="display: none;">
                    <label>Gang Farbe</label>
                    <input type="color" id="intel-color" value="#9c27b0">
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Farbe zur Erkennung der Gang</small>
                </div>
                
                <div class="form-group" id="person-gang-field" style="display: none;">
                    <label>Zugeh√∂rige Gang (optional)</label>
                    <select id="intel-gang-id">
                        <option value="">Keine Gang</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="intel-description" rows="4" placeholder="Zus√§tzliche Informationen..."></textarea>
                </div>
                
                <button type="submit" class="btn-primary">Speichern</button>
            </form>
        </div>

        <!-- Recipe Modal -->
        <div id="recipe-modal" class="modal recipe-modal-large" style="display: none;">
            <div class="modal-header recipe-modal-header">
                <div class="recipe-modal-title-wrapper">
                    <i class="fas fa-book"></i>
                    <h2 id="recipe-modal-title">Neues Rezept</h2>
                </div>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="recipe-form" class="recipe-form-grid">
                <input type="hidden" id="recipe-id">
                
                <!-- Linke Spalte -->
                <div class="recipe-form-left">
                    <div class="recipe-form-section">
                        <h3 class="recipe-section-title"><i class="fas fa-info-circle"></i> Grunddaten</h3>
                        
                        <div class="form-group">
                            <label><i class="fas fa-tag"></i> Rezeptname *</label>
                            <input type="text" id="recipe-name" required placeholder="z.B. AK-47 Herstellung">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label><i class="fas fa-folder"></i> Kategorie *</label>
                                <select id="recipe-category" required>
                                    <option value="">Kategorie w√§hlen</option>
                                    <option value="Waffen">üî´ Waffen</option>
                                    <option value="Drogen">üíä Drogen</option>
                                    <option value="Ausr√ºstung">üéΩ Ausr√ºstung</option>
                                    <option value="Fahrzeuge">üöó Fahrzeuge</option>
                                    <option value="Sonstiges">üì¶ Sonstiges</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-align-left"></i> Beschreibung</label>
                            <textarea id="recipe-description" rows="3" placeholder="Kurze Beschreibung des Rezepts..."></textarea>
                        </div>
                    </div>

                    <div class="recipe-form-section">
                        <h3 class="recipe-section-title"><i class="fas fa-cog"></i> Herstellung</h3>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label><i class="fas fa-clock"></i> Herstellungszeit (Min.)</label>
                                <input type="number" id="recipe-time" min="0" value="0" placeholder="0">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label><i class="fas fa-hashtag"></i> Anzahl pro Herstellung</label>
                                <input type="number" id="recipe-output-quantity" min="1" value="1" placeholder="1">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rechte Spalte -->
                <div class="recipe-form-right">
                    <div class="recipe-form-section">
                        <h3 class="recipe-section-title"><i class="fas fa-image"></i> Produktbild</h3>
                        <div class="image-upload-container-new">
                            <input type="file" id="recipe-image" accept="image/*" onchange="previewRecipeImage(event)">
                            <div id="recipe-image-preview" class="image-preview-new">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Bild hierher ziehen</span>
                                <small>oder klicken zum Ausw√§hlen</small>
                            </div>
                        </div>
                        <input type="text" id="recipe-image-url" class="image-url-input" placeholder="Oder Bild-URL eingeben..." oninput="loadRecipeImageFromUrl()">
                    </div>

                    <div class="recipe-form-section">
                        <h3 class="recipe-section-title"><i class="fas fa-sticky-note"></i> Notizen</h3>
                        <textarea id="recipe-notes" rows="3" placeholder="Wichtige Hinweise, Tipps, etc..."></textarea>
                    </div>
                </div>
                
                <!-- Zutaten - Volle Breite -->
                <div class="recipe-form-full">
                    <div class="recipe-form-section recipe-ingredients-section">
                        <div class="recipe-section-header">
                            <h3 class="recipe-section-title"><i class="fas fa-list"></i> Zutaten *</h3>
                            <button type="button" class="btn-add-ingredient" onclick="addIngredientRow()">
                                <i class="fas fa-plus"></i> Zutat hinzuf√ºgen
                            </button>
                        </div>
                        <div class="ingredients-header">
                            <span>Name</span>
                            <span>Menge</span>
                            <span>Einheit</span>
                            <span></span>
                        </div>
                        <div id="ingredients-container" class="ingredients-list">
                            <!-- Ingredient rows will be added here -->
                        </div>
                    </div>
                </div>
                
                <!-- Buttons -->
                <div class="recipe-form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModals()">
                        <i class="fas fa-times"></i> Abbrechen
                    </button>
                    <button type="submit" class="btn-primary btn-save-recipe">
                        <i class="fas fa-save"></i> Rezept speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Recipe Details Modal -->
        <div id="recipe-detail-modal" class="modal" style="display: none; max-width: 600px;">
            <div class="modal-header">
                <h2 id="recipe-detail-title">Rezept Details</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <div id="recipe-detail-content" class="recipe-detail-content">
                <!-- Content wird dynamisch gef√ºllt -->
            </div>
            <div class="modal-footer" style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn-secondary" onclick="closeModals()" style="flex: 1;">
                    <i class="fas fa-times"></i> Schlie√üen
                </button>
                <button id="recipe-detail-edit-btn" class="btn-primary" style="flex: 1;">
                    <i class="fas fa-edit"></i> Bearbeiten
                </button>
            </div>
        </div>

        <!-- Treasury Modals -->
        <!-- Add Transaction Modal -->
        <div id="add-transaction-modal" class="modal treasury-modal" style="display: none; max-width: 550px;">
            <div class="modal-header">
                <h2>Neue Transaktion</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="add-transaction-form">
                <div class="form-group">
                    <label for="transaction-type">Typ</label>
                    <select id="transaction-type" required onchange="toggleMemberSelection()">
                        <option value="">Typ ausw√§hlen</option>
                        <option value="einzahlung">Einzahlung</option>
                        <option value="auszahlung">Auszahlung</option>
                        <option value="korrektur">Korrektur</option>
                    </select>
                </div>
                <div class="form-group" id="transaction-member-group" style="display: none;">
                    <label for="transaction-member">Mitglied</label>
                    <select id="transaction-member">
                        <option value="">Mitglied ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transaction-amount">Betrag ($)</label>
                    <input type="number" id="transaction-amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="transaction-description">Beschreibung</label>
                    <input type="text" id="transaction-description" maxlength="500">
                </div>
                <div class="form-group">
                    <label for="transaction-reference">Referenznummer (optional)</label>
                    <input type="text" id="transaction-reference" maxlength="50">
                </div>
                <div class="form-group">
                    <label for="transaction-notes">Notizen (optional)</label>
                    <textarea id="transaction-notes" rows="3" maxlength="1000"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Transaktion hinzuf√ºgen</button>
                </div>
            </form>
        </div>

        <!-- Adjust Balance Modal (Kassenstand anpassen) -->
        <div id="adjust-balance-modal" class="modal treasury-modal" style="display: none; max-width: 450px;">
            <div class="modal-header">
                <h2><i class="fas fa-balance-scale"></i> Kassenstand anpassen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="adjust-balance-form">
                <div class="current-balance-display">
                    <span class="label">Aktueller Kassenstand:</span>
                    <span class="value" id="current-balance-display">$ 0,00</span>
                </div>
                <div class="form-group">
                    <label for="new-balance-amount">Neuer Kassenstand ($)</label>
                    <input type="number" id="new-balance-amount" step="0.01" required placeholder="Neuen Betrag eingeben">
                </div>
                <div class="balance-difference" id="balance-difference-preview" style="display: none;">
                    <span class="label">Differenz:</span>
                    <span class="value" id="balance-difference-value">$ 0,00</span>
                </div>
                <div class="form-group">
                    <label for="balance-adjust-reason">Grund f√ºr Anpassung</label>
                    <input type="text" id="balance-adjust-reason" placeholder="z.B. Kassenz√§hlung, Fehlerkorrektur..." maxlength="200">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Kassenstand setzen</button>
                </div>
            </form>
        </div>

        <!-- Set Contribution Modal -->
        <div id="set-contribution-modal" class="modal treasury-modal" style="display: none; max-width: 550px;">
            <div class="modal-header">
                <h2>Beitrag festlegen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="set-contribution-form">
                <div class="form-group">
                    <label for="contribution-period-type">Beitragstyp</label>
                    <select id="contribution-period-type" required onchange="updatePeriodFields()">
                        <option value="">Typ ausw√§hlen</option>
                        <option value="weekly">W√∂chentlich</option>
                        <option value="biweekly">Alle 2 Wochen</option>
                        <option value="monthly">Monatlich</option>
                        <option value="quarterly">Viertelj√§hrlich</option>
                        <option value="custom">Benutzerdefiniert</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contribution-period-start">Zeitraum Start</label>
                    <input type="date" id="contribution-period-start" required onchange="updatePeriodEnd()">
                </div>
                <div class="form-group">
                    <label for="contribution-period-end">Zeitraum Ende</label>
                    <input type="date" id="contribution-period-end" required>
                </div>
                <div class="form-group">
                    <label for="contribution-description">Beschreibung (automatisch generiert)</label>
                    <input type="text" id="contribution-description" readonly style="background: var(--dark-bg);">
                </div>
                <div class="form-group">
                    <label for="contribution-amount">Beitragsh√∂he ($)</label>
                    <input type="number" id="contribution-amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="contribution-due-date">F√§lligkeitsdatum</label>
                    <input type="date" id="contribution-due-date" required>
                </div>
                <div class="form-group">
                    <label for="contribution-notes">Notizen (optional)</label>
                    <textarea id="contribution-notes" rows="3" maxlength="1000"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Beitrag festlegen</button>
                </div>
            </form>
        </div>

        <!-- Create Week Modal -->
        <div id="create-period-modal" class="modal treasury-modal" style="display: none; max-width: 500px;">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-plus"></i> Neuen Beitragszeitraum anlegen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="create-period-form" onsubmit="submitCreatePeriod(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="period-start-date">Von</label>
                        <input type="date" id="period-start-date" required>
                    </div>
                    <div class="form-group">
                        <label for="period-end-date">Bis</label>
                        <input type="date" id="period-end-date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="period-amount">Beitrag pro Mitglied ($)</label>
                    <input type="number" id="period-amount" step="0.01" min="0" value="50.00" required>
                    <small class="form-hint">Beitrag f√ºr alle Mitglieder in diesem Zeitraum</small>
                </div>
                <div class="create-week-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Es werden Beitr√§ge f√ºr alle aktiven Mitglieder angelegt.</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary"><i class="fas fa-plus"></i> Zeitraum anlegen</button>
                </div>
            </form>
        </div>

        <!-- Mark Contribution Modal -->
        <div id="mark-contribution-modal" class="modal treasury-modal" style="display: none; max-width: 550px;">
            <div class="modal-header">
                <h2>Beitrag verbuchen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="mark-contribution-form">
                <div class="form-group">
                    <label for="mark-contribution-member">Mitglied</label>
                    <select id="mark-contribution-member" required onchange="loadMemberContributions()">
                        <option value="">Mitglied ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="mark-contribution-period">Offene Beitr√§ge</label>
                    <select id="mark-contribution-period" required onchange="updateContributionAmount()">
                        <option value="">Beitrag ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="mark-contribution-amount">Betrag ($)</label>
                    <input type="number" id="mark-contribution-amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="mark-contribution-payment-date">Zahlungsdatum</label>
                    <input type="datetime-local" id="mark-contribution-payment-date" required>
                </div>
                <div class="form-group">
                    <label for="mark-contribution-notes">Notizen (optional)</label>
                    <textarea id="mark-contribution-notes" rows="3" maxlength="1000"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary">Beitrag verbuchen</button>
                </div>
            </form>
        </div>

        <!-- Neues Ziel Modal -->
        <div id="add-goal-modal" class="modal treasury-modal" style="display: none; max-width: 550px;">
            <div class="modal-header">
                <h2><i class="fas fa-bullseye"></i> Neues Ziel erstellen</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="add-goal-form" onsubmit="submitGoal(event)">
                <div class="form-group">
                    <label for="goal-title">Titel*</label>
                    <input type="text" id="goal-title" placeholder="z.B. Sammelbestellung Waffen" required maxlength="200">
                </div>
                <div class="form-group">
                    <label for="goal-description">Beschreibung</label>
                    <textarea id="goal-description" rows="3" placeholder="Wof√ºr wird gesammelt?"></textarea>
                </div>
                <div class="form-group">
                    <label for="goal-amount">Zielbetrag ($)*</label>
                    <input type="number" id="goal-amount" step="0.01" min="1" required placeholder="5000.00">
                </div>
                <div class="form-group">
                    <label for="goal-deadline">Deadline (optional)</label>
                    <input type="date" id="goal-deadline">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary"><i class="fas fa-plus"></i> Ziel erstellen</button>
                </div>
            </form>
        </div>

        <!-- Ziel Einzahlung Modal -->
        <div id="contribute-goal-modal" class="modal treasury-modal" style="display: none; max-width: 550px;">
            <div class="modal-header">
                <h2><i class="fas fa-hand-holding-usd"></i> Einzahlung in Ziel</h2>
                <button class="close-modal" onclick="closeModals()">&times;</button>
            </div>
            <form id="contribute-goal-form" onsubmit="submitGoalContribution(event)">
                <input type="hidden" id="contribute-goal-id">
                <div class="goal-info-display" id="contribute-goal-info">
                    <!-- Ziel-Info wird hier angezeigt -->
                </div>
                <div class="form-group">
                    <label for="contribute-member">Mitglied*</label>
                    <select id="contribute-member" required>
                        <option value="">Mitglied ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contribute-amount">Betrag ($)*</label>
                    <input type="number" id="contribute-amount" step="0.01" min="0.01" required placeholder="100.00">
                </div>
                <div class="form-group">
                    <label for="contribute-comment">Kommentar (optional)</label>
                    <input type="text" id="contribute-comment" maxlength="500" placeholder="z.B. Anteil f√ºr 2 Pistolen">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModals()">Abbrechen</button>
                    <button type="submit" class="btn-primary"><i class="fas fa-check"></i> Einzahlen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
